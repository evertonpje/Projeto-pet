From a16bfb4b48fa9823975c71cacc46beae3588a986 Mon Sep 17 00:00:00 2001
From: evert <evert@Everton>
Date: 3 de abr. de 2025 18:22:09

Animal crud update

diff --git a/FOLY_PROJETO b/FOLY_PROJETO
new file mode 160000
index 0000000..95d7703
--- /dev/null
+++ b/FOLY_PROJETO
@@ -0,0 +1 @@
+Subproject commit 95d770395e325f5d2e1b0160dccbcb0501e71604
diff --git a/src/main/java/controller/AdocaoSRV.java b/src/main/java/controller/AdocaoSRV.java
new file mode 100644
index 0000000..54b3b6f
--- /dev/null
+++ b/src/main/java/controller/AdocaoSRV.java
@@ -0,0 +1,165 @@
+/*
+ * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
+ * Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/Servlet.java to edit this template
+ */
+package controller;
+
+
+import jakarta.servlet.RequestDispatcher;
+import jakarta.servlet.ServletException;
+
+import jakarta.servlet.http.HttpServlet;
+import jakarta.servlet.http.HttpServletRequest;
+import jakarta.servlet.http.HttpServletResponse;
+import model.Cliente;
+import model.Animal;
+import model.ClienteAnimal;
+
+import java.io.IOException;
+import java.util.ArrayList;
+import java.util.List;
+import model.dao.ClienteAnimalDaoJpa;
+import model.dao.DaoFactory;
+import model.dao.InterfaceDao;
+
+/**
+ *
+ * @author evert
+ */
+public class AdocaoSRV extends HttpServlet {
+
+    /**
+     * Processes requests for both HTTP <code>GET</code> and <code>POST</code>
+     * methods.
+     *
+     * @param request servlet request
+     * @param response servlet response
+     * @throws ServletException if a servlet-specific error occurs
+     * @throws IOException if an I/O error occurs
+     */
+    protected void processRequest(HttpServletRequest request, HttpServletResponse response)
+            throws ServletException, IOException {
+        response.setContentType("text/html;charset=UTF-8");
+      
+        
+            try {
+            String acao = request.getParameter("acao");
+            String clienteId = request.getParameter("cliente_id");
+            String animalId = request.getParameter("animal_id");
+            
+            
+            InterfaceDao dao = DaoFactory.novoClienteAnimalDAO();
+            
+            InterfaceDao<Cliente> clienteDao = DaoFactory.novoClienteDAO();
+            InterfaceDao<Animal> animalDao = DaoFactory.novoAnimalDAO();
+            ClienteAnimal adocao = null;
+           
+            RequestDispatcher rd = null;
+            
+            switch (acao) {
+                case "inclusao":
+                    Cliente cliente = clienteDao.pesquisarPorId(Integer.parseInt(clienteId));
+                    Animal animal = animalDao.pesquisarPorId(Integer.parseInt(animalId));
+                    
+                    if (cliente != null && animal != null && !animal.getAdotado()) {
+                        adocao = new ClienteAnimal(cliente, animal);
+                        try {
+                            dao.incluir(adocao);
+                            animal.setAdotado(true);
+                            animalDao.editar(animal);
+                        } catch (Exception ex) {
+                            System.out.println("Erro: " + ex.getMessage());
+                        }
+                    }
+                    
+                rd = request.getRequestDispatcher("AdocaoSRV?acao=listagem");
+                rd.forward (request, response);
+                
+                    break;
+                
+                case "listagem":
+                     String lista = listagem(); // Gera a lista HTML
+    System.out.println("Lista gerada: " + lista); // Depuração
+    request.setAttribute("lista", lista); // Passa para a JSP
+    rd = request.getRequestDispatcher("ListagemAdocao.jsp");
+    rd.forward(request, response);
+                    break;
+                   
+            }
+        } catch (Exception ex) {
+            System.out.println("Erro: " + ex.getMessage());
+        }
+    }
+    
+    private String listagem() {
+    InterfaceDao dao = new ClienteAnimalDaoJpa();
+    List<ClienteAnimal> lista = new ArrayList<>(); // Evita NullPointerException
+
+    try {
+        lista = dao.listar();
+    } catch (Exception ex) {
+        System.out.println("Erro ao listar adoções: " + ex.getMessage());
+    }
+
+    StringBuilder listaHTML = new StringBuilder();
+
+    for (ClienteAnimal clienteA : lista) {
+        String nomeCliente = (clienteA.getCliente() != null) ? clienteA.getCliente().getNome() : "Desconhecido";
+        String nomeAnimal = (clienteA.getAnimal() != null) ? clienteA.getAnimal().getNome() : "Desconhecido";
+
+        listaHTML.append("<tr>")
+                .append("<td>").append(clienteA.getId()).append("</td>")
+                .append("<td>").append(nomeCliente).append("</td>")
+                .append("<td>").append(nomeAnimal).append("</td>")
+                .append("</tr>");
+    }
+
+    return listaHTML.toString();
+}
+        
+        
+        
+        
+       
+    
+
+    // <editor-fold defaultstate="collapsed" desc="HttpServlet methods. Click on the + sign on the left to edit the code.">
+    /**
+     * Handles the HTTP <code>GET</code> method.
+     *
+     * @param request servlet request
+     * @param response servlet response
+     * @throws ServletException if a servlet-specific error occurs
+     * @throws IOException if an I/O error occurs
+     */
+    @Override
+    protected void doGet(HttpServletRequest request, HttpServletResponse response)
+            throws ServletException, IOException {
+        processRequest(request, response);
+    }
+
+    /**
+     * Handles the HTTP <code>POST</code> method.
+     *
+     * @param request servlet request
+     * @param response servlet response
+     * @throws ServletException if a servlet-specific error occurs
+     * @throws IOException if an I/O error occurs
+     */
+    @Override
+    protected void doPost(HttpServletRequest request, HttpServletResponse response)
+            throws ServletException, IOException {
+        processRequest(request, response);
+    }
+
+    /**
+     * Returns a short description of the servlet.
+     *
+     * @return a String containing servlet description
+     */
+    @Override
+    public String getServletInfo() {
+        return "Short description";
+    }// </editor-fold>
+
+}
diff --git a/src/main/java/controller/AnimalSRV.java b/src/main/java/controller/AnimalSRV.java
index be46ddc..33a25f0 100644
--- a/src/main/java/controller/AnimalSRV.java
+++ b/src/main/java/controller/AnimalSRV.java
@@ -63,7 +63,7 @@
                     System.out.println("Erro: " + ex.getMessage());
                     
                 }
-                rd = request.getRequestDispatcher("ListagemAnimal.jsp");
+                rd = request.getRequestDispatcher("AnimalSRV?acao=listagem");
                 rd.forward (request, response);
                 
                  break;
@@ -125,11 +125,14 @@
         }
         String listaHTML = " ";
         for (Animal animal : lista) {
+             String statusAdocao = (animal.getAdotado() != null && animal.getAdotado()) ? "Sim" : "Não";
             listaHTML = listaHTML
                     + "<tr>"
+                    + "<td>" + animal.getId() + "<td>"
                     + "<td>" + animal.getNome() + "<td>"
                     + "<td>" + animal.getEspecie()+ "<td>"
                     + "<td>" + animal.getRaca()+ "<td>"
+                     + "<td>" + statusAdocao + "</td>"
                     + "<td><form action=AnimalSRV?acao=pre-edicao method='POST'>"
                     + "<input type='hidden' name='id' value="
                     + animal.getId() + "><input type='submit' value=editar>"
diff --git a/src/main/java/controller/ClienteSRV.java b/src/main/java/controller/ClienteSRV.java
index 5e14b35..8176e45 100644
--- a/src/main/java/controller/ClienteSRV.java
+++ b/src/main/java/controller/ClienteSRV.java
@@ -60,7 +60,7 @@
                     System.out.println("Erro: " + ex.getMessage());
                     
                 }
-                rd = request.getRequestDispatcher("Listagem.jsp");
+                rd = request.getRequestDispatcher("ClienteSRV?acao=listagem");
                 rd.forward (request, response);
                 
                  break;
@@ -125,6 +125,7 @@
         for (Cliente cliente : lista) {
             listaHTML = listaHTML
                     + "<tr>"
+                    + "<td>" + cliente.getId()+ "<td>"
                     + "<td>" + cliente.getNome() + "<td>"
                     + "<td>" + cliente.getTelefone() + "<td>"
                     + "<td>" + cliente.getEmail() + "<td>"
diff --git a/src/main/java/model/Animal.java b/src/main/java/model/Animal.java
index 9ee4b4c..3114f42 100644
--- a/src/main/java/model/Animal.java
+++ b/src/main/java/model/Animal.java
@@ -4,6 +4,7 @@
  */
 package model;
 
+import javax.persistence.Column;
 import javax.persistence.Entity;
 import javax.persistence.GeneratedValue;
 import javax.persistence.GenerationType;
@@ -24,6 +25,10 @@
     private String especie;
     private String raca;
     
+      @Column(nullable = false, columnDefinition = "BOOLEAN DEFAULT FALSE")
+    private Boolean adotado = false;
+      
+      
 
     public Animal() {
     }
@@ -34,6 +39,15 @@
         this.especie = especie;
         this.raca = raca;
     }
+    
+
+    public Boolean getAdotado() {
+        return adotado;
+    }
+
+    public void setAdotado(Boolean adotado) {
+        this.adotado = adotado;
+    }
 
     public int getId() {
         return id;
@@ -69,9 +83,11 @@
 
     @Override
     public String toString() {
-        return "Animal{" + "id=" + id + ", nome=" + nome + ", especie=" + especie + ", raca=" + raca + '}';
+        return "Animal{" + "id=" + id + ", nome=" + nome + ", especie=" + especie + ", raca=" + raca + ", adotado=" + adotado + '}';
     }
 
+  
+
     
   
     
diff --git a/src/main/java/model/Cliente.java b/src/main/java/model/Cliente.java
index 291a028..88f80d1 100644
--- a/src/main/java/model/Cliente.java
+++ b/src/main/java/model/Cliente.java
@@ -32,7 +32,7 @@
    
     
      @OneToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL, orphanRemoval = false)
-    @JoinTable(
+      @JoinTable(
         name = "cliente_animal", 
         joinColumns = @JoinColumn(name = "cliente_id"), 
         inverseJoinColumns = @JoinColumn(name = "animal_id")
diff --git a/src/main/java/model/ClienteAnimal.java b/src/main/java/model/ClienteAnimal.java
new file mode 100644
index 0000000..c20e517
--- /dev/null
+++ b/src/main/java/model/ClienteAnimal.java
@@ -0,0 +1,64 @@
+/*
+ * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
+ * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
+ */
+package model;
+
+import java.time.LocalDate;
+import javax.persistence.Column;
+import javax.persistence.Entity;
+import javax.persistence.GeneratedValue;
+import javax.persistence.GenerationType;
+import javax.persistence.Id;
+import javax.persistence.JoinColumn;
+import javax.persistence.ManyToOne;
+import javax.persistence.Table;
+import model.Animal;
+import model.Cliente;
+
+/**
+ *
+ * @author evert
+ */@Entity
+@Table(name = "cliente_animal")
+public class ClienteAnimal {
+     @Id
+    @GeneratedValue(strategy = GenerationType.IDENTITY)
+    private int id;
+
+    @ManyToOne
+    @JoinColumn(name = "cliente_id", nullable = false)
+    private Cliente cliente;
+
+    @ManyToOne
+    @JoinColumn(name = "animal_id", nullable = false)
+    private Animal animal;
+
+  
+
+ 
+
+    public ClienteAnimal(Cliente cliente, Animal animal) {
+        this.cliente = cliente;
+        this.animal = animal;
+        
+    }
+
+    public ClienteAnimal() {
+    }
+
+    public int getId() {
+        return id;
+    }
+
+    public Cliente getCliente() {
+        return cliente;
+    }
+
+    public Animal getAnimal() {
+        return animal;
+    }
+
+}
+    
+
diff --git a/src/main/java/model/dao/ClienteAnimalDaoJpa.java b/src/main/java/model/dao/ClienteAnimalDaoJpa.java
new file mode 100644
index 0000000..7a58e17
--- /dev/null
+++ b/src/main/java/model/dao/ClienteAnimalDaoJpa.java
@@ -0,0 +1,103 @@
+/*
+ * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
+ * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
+ */
+package model.dao;
+
+import java.util.List;
+import javax.persistence.EntityManager;
+import javax.persistence.TypedQuery;
+import model.Animal;
+import model.ClienteAnimal;
+
+/**
+ *
+ * @author evert
+ */
+public class ClienteAnimalDaoJpa implements InterfaceDao<ClienteAnimal>  {
+
+    @Override
+    public void incluir(ClienteAnimal entidade) throws Exception {
+         EntityManager em = ConnFactory.getEntityManager();
+         try {
+            em.getTransaction().begin();
+            em.persist(entidade);
+            em.getTransaction().commit();
+        } finally {
+            em.close();
+        }
+        
+    }
+
+    @Override
+    public void incluirR(ClienteAnimal entidade) throws Exception {
+    }
+
+    @Override
+    public void excluirR(int id) throws Exception {
+        throw new UnsupportedOperationException("Not supported yet."); // Generated from nbfs://nbhost/SystemFileSystem/Templates/Classes/Code/GeneratedMethodBody
+    }
+
+    @Override
+    public void editar(ClienteAnimal entidade) throws Exception {
+        EntityManager em = ConnFactory.getEntityManager();
+        try {
+            em.getTransaction().begin();
+            em.persist(entidade);
+            em.getTransaction().commit();
+        } finally {
+            em.close();
+        }
+    }
+
+    @Override
+    public void excluir(ClienteAnimal entidade) throws Exception {
+             EntityManager em = ConnFactory.getEntityManager();
+              try {
+            em.getTransaction().begin();
+            ClienteAnimal ref = em.find(ClienteAnimal.class, entidade.getId());
+            if (ref != null) {
+                em.remove(ref);
+            }
+            em.getTransaction().commit();
+        } finally {
+            em.close();
+        }
+    }
+
+    @Override
+    public ClienteAnimal pesquisarPorId(int id) throws Exception {
+        EntityManager em = ConnFactory.getEntityManager();
+         try {
+            return em.find(ClienteAnimal.class, id);
+        } finally {
+            em.close();
+        }
+    }
+
+    @Override
+    public List<ClienteAnimal> listar() throws Exception {
+        EntityManager em = ConnFactory.getEntityManager();
+         try {
+            TypedQuery<ClienteAnimal> query = em.createQuery("SELECT c FROM ClienteAnimal c", ClienteAnimal.class);
+            return query.getResultList();
+        } finally {
+            em.close();
+        }
+    }
+
+    @Override
+    public List<ClienteAnimal> filtrarPorNome(String nome) throws Exception {
+        EntityManager em = ConnFactory.getEntityManager();
+        try {
+            TypedQuery<ClienteAnimal> query = em.createQuery("SELECT c FROM ClienteAnimal c WHERE c.cliente.nome LIKE :nome", ClienteAnimal.class);
+            query.setParameter("nome", "%" + nome + "%");
+            return query.getResultList();
+        } finally {
+            em.close();
+        }
+    }
+
+   
+}
+
diff --git a/src/main/java/model/dao/DaoFactory.java b/src/main/java/model/dao/DaoFactory.java
index 4abf862..903b9e9 100644
--- a/src/main/java/model/dao/DaoFactory.java
+++ b/src/main/java/model/dao/DaoFactory.java
@@ -9,5 +9,8 @@
     public static AnimalDaoJpa novoAnimalDAO() throws Exception {
         return new AnimalDaoJpa();
     }
+     public static ClienteAnimalDaoJpa novoClienteAnimalDAO() throws Exception {
+        return new ClienteAnimalDaoJpa();
+    }
     
 }
diff --git a/src/main/webapp/Listagem.jsp b/src/main/webapp/Listagem.jsp
index 8f047ff..e0c3c93 100644
--- a/src/main/webapp/Listagem.jsp
+++ b/src/main/webapp/Listagem.jsp
@@ -10,6 +10,7 @@
     <head>
         <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
         <title>Listagem de Clientes</title>
+         <a href="index.html" style="position: absolute; left: 200px;">Voltar</a>
     </head>
 
     <%
@@ -23,6 +24,8 @@
         <table border="0">
             <thead>
                 <tr>
+                     <th>ID</th>
+                      <th></th>
                     <th>Nome</th>
                     <th></th>
                     <th>Telefone</th>
diff --git a/src/main/webapp/ListagemAdocao.jsp b/src/main/webapp/ListagemAdocao.jsp
new file mode 100644
index 0000000..64b77c3
--- /dev/null
+++ b/src/main/webapp/ListagemAdocao.jsp
@@ -0,0 +1,44 @@
+<%-- 
+    Document   : ListagemAdocao
+    Created on : 3 de abr. de 2025, 14:49:28
+    Author     : evert
+--%>
+
+<%@page contentType="text/html" pageEncoding="UTF-8"%>
+<!DOCTYPE html>
+<html>
+    <head>
+        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+        <title>JSP Page</title>
+         <a href="index.html" style="position: absolute; left: 200px;">Voltar</a>
+    </head>
+    
+        <%
+       String listaHTML = (String) request.getAttribute("lista");
+    %>    
+    
+    
+    <body>
+          <br>
+        <br>
+    <center>
+        <table border="1">
+            <thead>
+                <tr>
+                    <th>ID</th>
+            
+                    <th>Cliente</th>
+              
+                    <th>Animal</th>
+                    
+                       
+                    
+                </tr>
+            </thead>
+            <tbody>
+                <%=listaHTML %>
+            </tbody>
+        </table>
+    </center>
+    </body>
+</html>
diff --git a/src/main/webapp/ListagemAnimal.jsp b/src/main/webapp/ListagemAnimal.jsp
index e880e7a..71b4160 100644
--- a/src/main/webapp/ListagemAnimal.jsp
+++ b/src/main/webapp/ListagemAnimal.jsp
@@ -10,6 +10,7 @@
     <head>
         <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
         <title>Listagem de animais</title>
+         <a href="index.html" style="position: absolute; left: 200px;">Voltar</a>
     </head>
 
     <%
@@ -23,14 +24,17 @@
         <table border="0">
             <thead>
                 <tr>
+                     <th>ID</th>
+                      <th></th
+                       <th></th>
                     <th>Nome</th>
                     <th></th>
                     <th>Especie</th>
                     <th></th>
                     <th>Raca</th>
                      <th></th>
-                       <th></th>
-                       <th></th>
+                       <th>Adotado</th>
+                 
                        
                     
                 </tr>
diff --git a/src/main/webapp/WEB-INF/web.xml b/src/main/webapp/WEB-INF/web.xml
index e465307..ff65809 100644
--- a/src/main/webapp/WEB-INF/web.xml
+++ b/src/main/webapp/WEB-INF/web.xml
@@ -8,6 +8,10 @@
         <servlet-name>AnimalSRV</servlet-name>
         <servlet-class>controller.AnimalSRV</servlet-class>
     </servlet>
+    <servlet>
+        <servlet-name>AdocaoSRV</servlet-name>
+        <servlet-class>controller.AdocaoSRV</servlet-class>
+    </servlet>
     <servlet-mapping>
         <servlet-name>ClienteSRV</servlet-name>
         <url-pattern>/ClienteSRV</url-pattern>
@@ -16,6 +20,10 @@
         <servlet-name>AnimalSRV</servlet-name>
         <url-pattern>/AnimalSRV</url-pattern>
     </servlet-mapping>
+    <servlet-mapping>
+        <servlet-name>AdocaoSRV</servlet-name>
+        <url-pattern>/AdocaoSRV</url-pattern>
+    </servlet-mapping>
     <session-config>
         <session-timeout>
             30
diff --git a/src/main/webapp/adoptionsForm.jsp b/src/main/webapp/adoptionsForm.jsp
index e286463..1ccde26 100644
--- a/src/main/webapp/adoptionsForm.jsp
+++ b/src/main/webapp/adoptionsForm.jsp
@@ -8,6 +8,11 @@
 <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
 <link rel="stylesheet" type="text/css" href="./css/styles.css"></head>
 <body>
+    
+       <%
+        String acao = request.getParameter("acao");
+        %>
+        
     <header>
         <a href="index.html" style="position: absolute; left: 200px;">Voltar</a>
         <div class="logo">
@@ -15,18 +20,21 @@
         </div>
     </header>
     <section class="main">
-        <form action="#">
+     <form action="AdocaoSRV" method="POST">
+         <input type="hidden" name="acao" value="<%=acao %>">
+             
             <h1 style="margin-bottom: 30px; text-align: center;">Criar Adocao</h1>
             <div class="form-input">
-                <label for="userId"> ID do Usuario</label>
-                <input type="number" name="userId" id="userId"/>
+                <label for="userId"> Cliente</label>
+                <input type="text" name="cliente_id" id="cliente_id"  value=""/>
             </div>
             <div class="form-input">
-                <label for="petId">ID do Pet</label>
-                <input type="number" name="petId" id="petId"/>
+                <label for="petId">Animal</label>
+                <input type="text" name="animal_id" id="animal_id" value=""/>
             </div>
-            <input type="submit" value="Criar" class="submit">
+            <input type="submit" value="Adotar" class="submit">
         </form>
+             
     </section>
 </body>
 </html>
diff --git a/src/main/webapp/index.html b/src/main/webapp/index.html
index 309db76..1e5caab 100644
--- a/src/main/webapp/index.html
+++ b/src/main/webapp/index.html
@@ -34,7 +34,7 @@
                             </div>
                             <div class="overview-item">
                                 <div class="overview-left">
-                                    <small>Total de Adocoes</small>
+                                   <h3><a href="AdocaoSRV?acao=listagem">Listagem De Adocões</a></h3>
                                   
                                 </div>
                             </div>
@@ -78,7 +78,7 @@
             </div>
 
             <div class="pets">
-                <div class="pets-title">Adocoes  <a href="adoptionsForm.jsp"><button class="add-button">Adicionar Adocao +</button></div></a>
+                <div class="pets-title">Adocoes <a href="adoptionsForm.jsp?acao=inclusao"><button class="add-button">Adicionar Adocao +</button></div></a>
                 <div class="pets-grid">
                       <div class="pet-item">
                             <img class="pet-img" />
